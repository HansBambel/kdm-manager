<!doctype html>
<html ng-app="theWatcher" ng-controller="globalController">
 <title>http://thewatcher.io - The Watcher - {{ settings.application.title }}</title>
 <head>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71038485-2', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.5.3/angular-route.min.js"></script>
    <script src="/static/js/documentation.js"></script>
    <link rel="stylesheet" href="/static/css/style.css" />
 </head>


 <body>

    <h1>KD:M API</h1>
    <h2>A RESTful API for <i>Monster</i>, by Kingdom Death</h2>
    <h3> Version {{ settings.api.version }} documentation</h3>

    <table class="api_documentation">
        <tr><th colspan="3">API Documentation!</th></tr>
        <tr><td colspan="3">

        <p>The KDM API at <a href="https://api.thewatcher.io">https://api.thewatcher.io</a>
        is a RESTful API for campaign/settlement management in "Monster" by
        <a href="http://kingdomdeath.com" target="top">Kingdom Death</a>.</p>
        <p>The API is a fan-created and fan-maintained project that is not
        supported by, affiliated with or otherwise authorized by Kingdom Death.</p>
<!--    <p>Are you a developer interested in using the API for your Kingdom Death
        project? <a href="">Start here!</a></p> -->
        <p>
            <a href="https://github.com/toconnell/kdm-manager" target="top">GitHub</a> |
            <a href="https://twitter.com/kdmManager" target="top">Twitter</a> |
            <a href="http://kdm-manager.blogspot.com/" target="top">Development blog</a>
        </p>

    </table>

    <table class="api_documentation public_routes">

        </td></tr>
        <tr><th colspan="3">PUBLIC ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>
                    These routes <b>DO NOT</b> require authentication. Use them
                    to construct dashboard, "create new whatever" type views and
                    to look up game asset data that does not belong to any user.
                </p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>


        <tr class="ul route_root">
            <th colspan="3">
                <p><b>User creation and auth:</b> these public routes are how you
                want to create new users and authenticate existing ones.</p>
            </th>
        </tr>
        <tr class="ul">
            <td> /new/user </td>
            <td> <b>POST</b>, OPTIONS</td>
            <td> <p>Include the valid email address and password in the JSON body
            of your <b>POST</b> to create a new user:</p>
            <code>{'username': 'demo@kdm-manager.com', 'password': 'tehH4x0r'}</code>
            <p> If you get a 200 back from the API, the user was created without
            issue. Otherwise, this route produces some pretty explicit feedback
            when it returns anything other than a 200.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/login">/login</a> </td>
            <td> <b>POST</b> </td>
            <td>
                <p>        
                    The KD:M API uses JSON Web Tokens (<a
                    href="https://jwt.io/">https://jwt.io</a>) to manage user
                    sessions and user authentication.
                </p>
                <p> <b>POST</b> to this route with JSON containing user credentials in
                the body of the request to get a token:</p>
                <code>{"username": "demo@kdm-manager.com", "password": 
                "l33th4x0r"}</code>
                <p>...if your credential checks out, you get a token and the the
                the user's ID (see below for working with users) back. Easy!</p>
            </td>
        </tr>

        <tr class="ul route_root">
            <th colspan="3"><b>Password reset routes:</b> use these two routes
            to build a password reset mechanism. </th>
        </tr>
        <tr class="ul">
            <td> /reset_password/request_code </td>
            <td> <b>GET</b> </td>
            <td> <p> Resetting a password is a two-part process: first, you request
            a recovery code by posting a registered user's email address to this
            route. This emails your user with a URL that they can use to reset
            their PW. <p>
            <p> To request a recovery code, simply <b>POST</b> some JSON containting the
            email of the user:</p>
            <code>{'username': 'demo@kdm-manager.com'}</code>
            <p>If this comes back 200, then the user has been emailed. Otherwise,
            if you get a non-200 response, it'll have specific reasons why it did
            not work.</p>
            <p>Additionally, if you want to handle the password reset in your own
            app (the default app is https://kdm-manager.com), which you probably do,
            just include the <code>app_url</code> attribute in your post:</p>
            <code>{'username': 'demo@kdm-manager.com', 'app_url': 'https://my-badass-kdm-app.com'}</code>
            <p>Assuming that the user email is legint, <b>POST</b>ing this value
            will cause the email that the user receives to include your URL:</p>
            <code><pre>
Hello demo@kdm-manager.com!

 You are receiving this message because https://my-badass-kdm-app.com recieved
a password reset request for your user, demo@kdm-manager.com.

 If you did not initiate a password reset request, please ignore this email
and continue to use your existing/current credentials: they will not be
altered in any way!

 If you made this request and would like to reset your password, please sign
into https://my-badass-kdm-app.com using this link:

 https://my-badass-kdm-app.com?recover_password=True&recovery_code=MC9AU4I4NFYKJ3TWPLWVPHX29N2U08
            </pre></code>
            <p>From here, you would parse the user's request to your (badass) app,
            get their email address and the password they want to use, 
            and then use the <code>/reset_password/reset</code> endpoint (below)
            to finish the job.</p>
            <p><b>PROTIP:</b> the recovery URL that the API generates for the email
            starts at the question mark, so you can put in whatever endpoint you
            need on your own app, e.g. "https://my-badass-kdm-app/reset_password"
            or similar. Just be careful not to use a trailing slash!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /reset_password/reset </td>
            <td> <b>GET</b> </td>
            <td> <p> Before you <b>POST</b> to this route, you need a recovery code.<p>
            <p>Once you have it, include it with the user's email and <b>new</b> password
            in the body of your request:</p>
            <code>{'username': 'demo@kdm-manager.com', 'password': 's3cr3tP4ss',
            'recovery_code': '9FH3BKSNFI37FB476ZHABNDOWHEUSYAB234'}</code>
            <p>If your post comes back with a 200, then the user's password has
            been changed to the password you posted, and you can use it to log
            them in.</p>
        </tr>


        <tr class="ul route_root">
            <th colspan="3">
                <p><b>UI/UX Helpers:</b> these routes are intended to help with
                user experience by rapidly returning basic asset sets.</p>
            </th>
        </tr>
        <tr class="ul">
            <td> <a href="/get_random_names/10">/get_random_names/&lt;count&gt;</a></td>
            <td> <b>GET</b> </td>
            <td> 
                <p>Returns <code>count</code> random names for each possible
                survivor sex.</p>
                <p><b>Important!</b>This method DOES NOT accept <b>POST</b>-type
                requests and <code>count</code> must be an integer!</p>
                <p>Output looks like this:</p>
                <pre><code>{
    "M": [
        "Fingal",
        "Pelagius",
        "Stark"
    ],
    "F": [
        "Hope",
        "Moana",
        "Rasha"
    ]
}
</code></pre>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/get_random_surnames/10">/get_random_surnames/&lt;count&gt;</a></td>
            <td> <b>GET</b> </td>
            <td> 
                <p>Returns <code>count</code> random surnames.</p>
                <p>Output is just an array of strings:</p>
                <pre><code>[
    "Skyhunter",
    "Darkhunter",
    "Stormson",
    "Butcher",
    "Hammerheart"
]</code></pre>
                <p><b>Important!</b>This method DOES NOT accept <b>POST</b>-type
                requests and <code>count</code> must be an integer!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/new_settlement">/new_settlement</a></td>
            <td> <b>GET</b> </td>
            <td>
                <p>This route is deprecated! Use <code>/game_asset/new_settlement
                </code> instead.</p>
            </td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3">
                <p><b>Dashboard:</b> the public endpoints here are meant to be
                used to create a dashboard or landing page type of view.
            </th>
        </tr>
        <tr class="ul">
            <td> <a href="/settings.json">/settings.json</a> </td>
            <td> <b>GET</b></td>
            <td> Not strictly a part of the API, but sometimes useful. Hit this
            route to download an attachement of settings.cfg as JSON. </td>
        </tr>
        <tr class="ul">
            <td> <a href="/settings">/settings</a> </td>
            <td> <b>GET</b> </td>
            <td> Retrieve settings.cfg as JSON</td>
        </tr>
        <tr class="ul">
            <td> <a href="/world">/world</a> </td>
            <td> <b>GET</b> </td>
            <td> Retrieve a JSON representation of aggregate/world stats.</td>
        </tr>



        <tr class="ul route_root">
            <th colspan="3">
                <p><b>Game asset lookup routes:</b> use these endpoints to get
                information about game assets, e.g. monsters, gear, etc.</p>
                <p>Each of these routes works essentially the same way. You can
                <b>POST</b> a query to one and retireve data about a single asset if you
                know its name or handle -OR- you can <b>GET</b> the route to get a list
                of all assets.</p>
                <p> The following lookups are currently supported by the public API:</p>
                <ul>
                    <li><a href="/game_asset/abilities_and_impairments">
                        /game_asset/abilities_and_impairments</a>
                    </li>
                    <li><a href="/game_asset/campaign">
                        /game_asset/campaign</a> (campaign definitions)
                    </li>
                    <li><a href="/game_asset/disorder">
                        /game_asset/disorder</a>
                    </li>
                    <li><a href="/game_asset/expansion">
                        /game_asset/expansion</a>
                    </li>
                    <li><a href="/game_asset/fighting_art">
                        /game_asset/fighting_art</a>
                    </li>
                    <li><a href="/game_asset/gear">
                        /game_asset/gear</a>
                    </li>
                    <li><a href="/game_asset/monster">
                        /game_asset/monster</a>
                    </li>
                    <li><a href="/game_asset/resource">
                        /game_asset/resource</a>
                    </li>
                    <li><a href="/game_asset/rules">
                        /game_asset/rules</a>
                    </li>
                    <li><a href="/game_asset/storage">
                        /game_asset/storage</a> (settlement storage location types)
                    </li>
                </ul>
            </th>
        </tr>
        <tr class="ul">
            <td> <a href="/campaign">/campaign</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>This endpoint is deprecated. Use <code>/game_asset/campaign</code> instead.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/expansion">/expansion</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>This endpoint is deprecated. Use <code>/game_asset/expansion</code> instead.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/game_asset/campaign">/game_asset/campaign</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>Accepts a <code>name</code> or <code>handle</code> parameter included in the body
                of the request (which should be JSON) and returns a JSON
                representation of a campaign asset:</p>
                <code>{"name": "People of the Lantern"}</code>
                <p>...gets you back something like this:</p>
                <code>{"handle": "people_of_the_lantern","milestones":
                ["first_child", "first_death", "pop_15", "innovations_5",
                "game_over" ], "saviors": "1.3.1", "name": "People of the Lantern",
                "default": true, "principles": ["new_life", "death", "society",
                "conviction"], "always_available": { "location": ["Lantern
                Hoard"], "innovation": ["Language"]},"nemesis_monsters": [
                "butcher", "kings_man","the_hand","watcher"],"quarries": [
                "white_lion","screaming_antelope","phoenix", "beast_of_sorrow",
                "great_golden_cat", "mad_steed", "golden_eyed_king"],"type":
                "campaign_definition"}</code>
                <p>This also works with handles, e.g.:</p>
                <code>{"handle": "people_of_the_stars"}</code>
                <p>Like all lookup routes, if you <b>GET</b> this endpoint,
                the API will return the definitions of all assets.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/game_asset/expansion">/game_asset/expansion</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p><b>POST</b> a <code>name</code> or <code>handle</code> to this endpoint
                to get a particular expansion's asset definition.</p>
                <p>For example, if you <b>POST</b> this:</p>
                <code>{handle: "gorm"}</code>
                <p>You'll get back a nice hunk of JSON definiting the asset:</p>
                <pre><code>{
    "ui": {
        "pretty_category": "Quarry"
    },
    "quarries": [
        "gorm"
    ],
    "name": "Gorm",
    "always_available": {
        "location": [
            "Gormery",
            "Gormchymist"
        ],
        "innovation": [
            "Nigredo"
        ]
    },
    "released": {
        "$date": 1457913600000
    },
    "type_pretty": "Expansion",
    "timeline_add": [
        {
            "handle": "gorm_approaching_storm",
            "type": "story_event",
            "ly": 1
        },
        {
            "handle": "gorm_gorm_climate",
            "type": "settlement_event",
            "name": "Gorm Climate",
            "ly": 2
        }
    ],
    "handle": "gorm",
    "type": "expansion",
    "sub_type": "expansion",
    "flair": {
        "color": "EAE40A",
        "bgcolor": "958C83"
    }
}</code></pre>
                <p>This route also supports lookups via <code>name</code> values,
                e.g. <code>{name: "Flower Knight"}</code> or similar.</p>
                <p>If you <b>GET</b> this route, it will return the definitions
                for all supported expansion content as a dictionary/hash.</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/game_asset/gear">/game_asset/gear</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p><b>POST</b> a <code>name</code> or <code>handle</code> to this endpoint
                to do gear lookups:</p>
                <code>{handle: "lantern_halberd"}</code>
                <p>...gets you back a JSON representation of the asset:</p>
                <pre><code>{
    "handle": "lantern_halberd",
    "name": "Lantern Halberd",
    "rules": [
        "Reach 2",
        "Irreplaceable",
        "Unique"
    ],
    "type_pretty": "Gear",
    "keywords": [
        "weapon",
        "melee",
        "two-handed",
        "spear",
        "other"
    ],
    "type": "gear",
    "sub_type": "rare_gear",
    "desc": "After attacking, if standing, you may move up to 2 spaces directly away from the monster."
}</code></pre>
                <p>This route also supports <code>name</code> lookups, e.g. <code>
                {name: "Vespertine Bow"}</code>, etc.</p>
                <p><b>GET</b> this endpoint to dump all gear.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/game_asset/monster">/game_asset/monster</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>
                    Accepts a "name" or "handle" parameter in the <b>POST</b> body and
                    returns a JSON representation of a monster type game asset.
                    For example, <b>POST</b>ing to /monster with JSON such as this:
                </p>
                <code>{"name": "White Lion Lvl. 1"}</code>
                <p>...returns JSON like this: </p>
                <code>{"comment": "Lvl. 1", "handle": "white_lion", "name":
                "White Lion", "level": 1, "levels": 3, "sort_order": 0, "type":
                "quarry"}
                <p>Or, with a handle:</p>
                <code>{"handle": "manhunter"}</code>
                <p>...you get:</p>
                <pre><code>{
    "handle": "manhunter",
    "name": "Manhunter",
    "levels": 4,
    "sort_order": 103,
    "type": "nemesis",
    "selectable": false, 
    "misspellings": ["THE MANHUNTER", "MAN HUNTER"],
}</code></pre>
                <p>Like all lookup routes, if you <b>GET</b> this endpoint,
                the API will return the definitions of all assets.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/gear">/gear</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>This endpoint is deprecated. Use <code>/game_asset/gear</code> instead.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/monster">/monster</a> </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p>This endpoint is deprecated. Use <code>/game_asset/monster</code> instead.</p>
            </td>
        </tr>
    </table>


    <table class="api_documentation private_routes">
        <tr><th colspan="3">PRIVATE ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>Private routes require an Authorization header including a
                JWT token.</p>
                <p>(See the documentation above for more info on how to <b>POST</b>
                user credentials to the <code>/login</code> route to get a
                token.)</p>
                <p>Generally speaking, when you access any private route, you 
                want your headers to look like this when using private routes:
                </p>
                <code>
                {
                    'content-type': 'application/json',
                    'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6...'
                }
                </code>
                <p>Finally, keep in mind that tokens are extremely short-lived,
                so you should be prepared to refresh them frequently. See the
                section below on 'Authorization Token Management' for more info
                on checking/refreshing tokens.</p>
                <p><b>Important!</b> In order to support the CORS pre-flight
                checks that most browsers are going to auto-magically perform
                before <b>POST</b>ing to one of these routes, <u>all private routes
                supported by the KD:M API also support the <code>OPTIONS</code>
                method</u>, regardless of how they are documented below.</p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>

        <tr class="ul route_root">
            <th colspan="3"><b>Authorization Token Management:</b> once you've
            got an authorization token, you can work with it using these
            routes. Most failures from these routes are reported back as
            401's, since they concern authorization. </th>
        </tr>
        <tr class="ul">
            <td> /authorization/check</td>
            <td> <b>GET</b>,<b>POST</b>,OPTIONS </td>
            <td> 
            <b>GET</b> or <b>POST</b> to this endpoint to determine if your Authorization header
            is still valid or if it has expired.
            </td>
        </tr>
        <tr class="ul">
            <td> /authorization/refresh</td>
            <td> <b>POST</b>,OPTIONS</td>
            <td> 
            <p> Use the standard 'Authorization' header and <b>POST</b> an empty request to
            this route to recieve a new Auth token based on the previous one.</p>
            <p> On the back end, this route reads the incoming 'Authorization'
            header and, even if the JWT token is expired, will check the 'login'
            and 'password' (hash) keys: if they check out, you get a 200 and a
            brand new token.</p>
            <p> Finally, the KDM API does NOT use refresh tokens (it just feels 
            like overkill, you know?).</p>
            </td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>Administrative views and data:</b> If your user
            has the 'admin' attribute, you can hit these routes to retrieve data
            about application usage, etc.</th>
        </tr>
        <tr class="ul">
            <td> /admin/view/panel</td>
            <td> <b>GET</b> </td>
            <td><p>API Admin panel. Uses HTTP basic auth (no cookies/no sessions)
            and requires a user have the 'admin' bit flipped on their user.</p></td>
        </tr>
        <tr class="ul">
            <td> /admin/get/user_data</td>
            <td> <b>GET</b> </td>
            <td><p>Retrieves a nice, juicy hunk of JSON re: recent users of the API.</p></td>
        </tr>
        <tr class="ul">
            <td> /admin/get/logs</td>
            <td> <b>GET</b> </td>
            <td><p>Dumps the contents of a number of system logs from the local
            filesystem where the API is running and represents them as JSON.</p></td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>User Routes:</b> all routes for working directly with a user follow a <code>/user/&lt;action&gt;/&lt;settlement_id&gt;</code> convention. These routes are private and require authentication.</th>
        </tr>
        <tr class="ul">
            <td> /user/dashboard/&lt;user_id&gt; </td>
            <td> <b>GET</b>, OPTIONS</td>
            <td>
                <p>This fetches a serialized version of the user that includes the
                <code>/world</code> output as well as a bunch of info about the
                user, including their friends, settlements they own or are
                playing in, etc.</p>
                <p>Here's a run-down of the key elements:</p>
                <pre><code>{
    "is_application_admin": true,
    "meta": {...},
    "user": {...},
    "preferences": [...],
    "dashboard": {
        "campaigns": [...],
        "settlements": [...],
    },
}</code></pre>
                <p>The top-level <code>dashboard</code> element includes two arrays:
                <code>campaigns</code> and <code>settlements</code>.</p>
                <p>The <code>campaigns</code> array is a <b>reverse-chronological</b> list
                of OIDs of all settlements where the user owns a survivor (i.e.
                the survivor's <code>email</code> attribute matches the users
                <code>login</code> attribute.</p>
                <p>This list can include settlements owned/created by other users:
                the basic idea behing the <code>campaigns</code> list is that
                you probably want to show these settlements to the user when they
                sign in or when they choose which settlement they want to view.</p>
                <p>The <code>campaigns</code> array <u>does not</u> include any
                'abandoned' settlements (i.e. any settlement with a Boolean True
                value for the <code>abandoned</code> attribute.</p>
                <p>See
                <a href="/#settlementAbandon"><code>/settlement/abandon/oid</code>
                 (below)</a> for more on abandoning a settlement. </p>
                <p>Conrastively, the <code>settlements</code> array is a
                <b>chronologically</b> sorted list of all settlement OIDs that belong
                 to the current user, whether abandoned or not.</p>
                <p>This is more of an archival/historical sort of list, meant to
                facilitate that kind of view/list/UX.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/get/&lt;user_id&gt; </td>
            <td> <b>GET</b>, OPTIONS </td>
            <td><p>Retrieve a serialized version of the user who owns &lt;user_id&gt;,
            to include some additional usage and meta facts about that user.</p>
            <p>Like many of the <code><b>GET</b></code> routes supported by the KD:M API,
            this route will return user info whether you use <code><b>POST</b></code> or
            any other supported method.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/set/&lt;user_id&gt; </td>
            <td> <b>POST</b>, OPTIONS </td>
            <td> <p>This route supports the assignment of user-specified key/value
            attributes to the user object.</p><p>To set an attribute, include
            JSON in the body of the request that indicates the key/value to set.</p>
            Supported attribute keys include:
                <table class="embedded_table">
                    <tr><th>key</th><th>value</th></tr>
                    <tr><td class="key">current_settlement</td><td class="value">
                    OID of an existing,non-removed settlement.</td></tr>
                </table>
            Use multiple key/value pairs to set multiple attributes in a single
            request, e.g. <code>{"current_settlement": $oid, "current_session":
            $oid}</code>
            </p>
            <p><b>Important!</b> This route does not support the assignment of
            arbitrary keys and will completely fail any request that includes
            unsupported keys!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/set_preferences/&lt;user_id&gt; </td>
            <td> <b>POST</b>, OPTIONS </td>
            <td>
                <p><b>POST</b> a list of hashes to this endpoint to set user preferences.</p>
                <p>Your list has to be named <code>preferences</code> and your
                hashes have to be key/value pairs where they key is a valid
                preferences handle and the key is a Boolean:</p>
                <code>{preferences: [{handle: "beta", value: true}, {...}]}</code>
                <p>Since this is mostly a sysadmin/back-of-house kind of route,
                it fails pretty easily if you try to <b>POST</b> something it doesn't
                like. The good news, is that it should fail pretty descriptively.</p>
            </td>
        </tr>
        <tr>
            <td class="subsection_header" colspan="3"><b>User Collection Management:</b>
            The endpoints defined below are used to manage the User's IRL
            collection of game assets, e.g. Expansions, etc.</td>
        </tr>
        <tr class="ul">
            <td> /user/add_expansion_to_collection/&lt;user_id&gt; </td>
            <td> <b>POST</b>, OPTIONS </td>
            <td>
                <p>You can <b>POST</b> a single expansion handle to this endpoint
                to add it to a user's collection of expansions:</p>
                <code>{handle: "manhunter"}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/rm_expansion_from_collection/&lt;user_id&gt; </td>
            <td> <b>POST</b>, OPTIONS </td>
            <td>
                <p><b>POST</b> some basic JSON to this endpoint to remove an
                expansion handle from a user's collection:</p>
                <code>{handle: "flower_knight"}</code>
            </td>
        </tr>





        <tr class="ul route_root">
            <th colspan="3"><b>Create Assets:</b> To create new assets (user, survivor, settlement),
            <b>POST</b> JSON containing appropriate params to the /new/&lt;asset_type&gt;
            route. Invalid or unrecognized params will be ignored!</th>
        </tr>
        <tr class="ul">
            <td> /new/settlement </td>
            <td> <b>POST</b>, OPTIONS </td>
            <td> <p>Use 'handle' values from the <code>/game_asset/new_settlement</code>
            route (see above) as params, like this:</p>
            <code> {"campaign": "people_of_the_lantern", "expansions": ["dung_beetle_knight",
            "lion_god"], "survivors": ["adam", "anna"], "name": "Chicago",
            "special": ["create_first_story_survivors"]}
            </code>
            <p>If successful, this route returns a serialized version of the new settlement,
            including its OID, as JSON.</p>
            <p>The following <code>special</code> values are supported by the API:</p>
                <table class="embedded_table">
                    <tr><th>value</th><th>result</th></tr>
                    <tr>
                     <td class="key">create_first_story_survivors</td>
                     <td class="value">Creates two male and two female survivors,
                     assigns them names and places Founding Stones and Cloths in
                     Settlement Storage.</td>
                    </tr>
                    <tr>
                     <td class="key">create_seven_swordsmen</td>
                     <td class="value">Creates seven random survivors with the
                    'Ageless' and Sword Mastery A&Is. </td>
                    </tr>
                </table>
            <p><b>Important!</b> Unsupported <code>special</code> values are
            ignored.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a id="newSurvivor"></a>/new/survivor </td>
            <td> <b>POST</b>, OPTIONS</td>
            <td> <p>This works differently from <code>/new/settlement</code> in
            a number of significant ways.</p>
            <p> In a nutshell, the basic idea here is that the only required key
            in the JSON you <b>POST</b> to this route is an object ID for the settlement
            to which the survivor belongs:</p>
            <code>{'settlement': '59669ace4af5ca799c968c94'}</code>
            <p> Beyond that, you are free to supply any other attributes of the
            survivor, so long as they comply with the data model for survivors.</p>
            <p> Consult the <a href="/#survivorDataModel">Survivor Data Model (below)</a> for a
            complete reference on what attributes of the survivor may be set at
            creation time.</p>
            <p>As a general piece of advice, it typically makes more sense to
            just initialize a new survivor with defaults and then operate on it
            using the routes below, unless you're doing something inheritance.</p>
            <p>For normal inheritance, simply <b>POST</b> the OID's of one or
            more of the survivor's parents like so:</p>
            <code>{settlement: '59669ace4af5ca799c968c94', father: '5a341e6e4af5ca16907c2dff'}</code>
            <p>...or like so:</p>
            <code>{settlement: '59669ace4af5ca799c968c94', father: '5a341e6e4af5ca16907c2dff', mother: '5a3419c64af5ca11240f519f'}</code>
            <p>This will cause normal inheritance rules to be triggered when the
            new survivor is created.</p>
            <p>In order to trigger conditional or special inheritance, e.g. where
            an innovation requires the user to select a single parent as the donor,
            you <u>must</u> specify which parent is the donor using the <code>
            primary_donor_parent</code> key and setting it to 'father' or 'mother':</p>
            <code>{settlement: '59669ace4af5ca799c968c94', father: '5a341e6e4af5ca16907c2dff', mother: '5a3419c64af5ca11240f519f', primary_donor_parent: 'father'}</code>
            <p>This will cause innovations such as <b>Family</b> to use the primary
            donor parent to follow one-parent inheritance rules for that innovation.</p>
            <p>As of API releases > 0.77.n, survivors can be created with an avatar.
            Inclde the <code>avatar</code> key in the <b>POST</b> body, and let
            that key's value be a string representation of the image that should
            be used as the survivor's avatar.</p>
            <p>(<a href="/#setAvatarAnchor">See <code>/survivor/set_avatar/<oid></code> route below</a> for more
            information on how to post string representations of binary content.</p>
            <p><b>Important!</b>Just like the <code>/new/settlement</code> route,
            a successful <b>POST</b> to the <code>/new/survivor</code> route will return
            a serialized version (i.e. JSON) of the new survivor, complete with
            the <code>sheet</code> element, etc.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /new/survivors </td>
            <td> <b>POST</b>, OPTIONS</td>
            <td>
                <p>Not to be confused with <code>/new/survivor</code> (above),
                this route adds multiple new survivors, rather than just one.</p>
                <p>The JSON you have to <b>POST</b> to this route is a little different
                and more limited than what you would post to <code>/new/survivor</code>.</p>
                <p>The following <b>POST</b> key/value pairs are the only ones supported
                by this route:</p>
                <table class="embedded_table">
                <tr><th>key</th><th>O/R</th><th>value type</th><th>comment</th>
                <tr>
                    <td class="small_key">settlement_id</td>
                    <td class="small_key"><b>R</b></td>
                    <td class="type">settlement OID</td>
                    <td class="value">The OID of the settlement to which the new survivors belong.</td>
                </tr>
                <tr>
                    <td class="small_key">public</td>
                    <td class="small_key">O</td>
                    <td class="type">boolean</td>
                    <td class="value">
                        The value of the new survivors' <code>public</code>
                         attribute. Defaults to <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td class="small_key">male</td>
                    <td class="small_key">O</td>
                    <td class="type">arbitrary int</td>
                    <td class="value">The number of male survivors to create.</td>
                </tr>
                <tr>
                    <td class="small_key">female</td>
                    <td class="small_key">O</td>
                    <td class="type">arbitrary int</td>
                    <td class="value">The number of female survivors to create.</td>
                </tr>
                <tr>
                    <td class="small_key">father</td>
                    <td class="small_key">O</td>
                    <td class="type">survivor OID</td>
                    <td class="value">The OID of the survivor that should be the father of the new survivors.</td>
                </tr>
                <tr>
                    <td class="small_key">mother</td>
                    <td class="small_key">O</td>
                    <td class="type">survivor OID</td>
                    <td class="value">The OID of the survivor that should be the mother of the new survivors.</td>
                </tr>
                </table>
                <p>Creating new survivors this way is very simple. This JSON, for
                example, would create two new male survivors:</p>
                <code>{"male": 2, "settlement_id": "5a1485164af5ca67035bea03"}</code>
                <p>A successful <b>POST</b> to this route always returns a list of
                serialized survivors (i.e. the ones that were created), so if
                you are creating more than four or five survivors, this route is
                a.) going to take a couple/few seconds to come back to you and b.)
                is going to drop a pile of JSON on your head. YHBW.</p>
                <p>NB: this route <i>does not</i> support random sex assignment.</p>
            </td>
        </tr>



        <tr class="ul route_root">
            <th colspan="3">
            <p><b>Settlement Routes:</b> all routes for working directly with a
            settlement follow a <code>/settlement/&lt;action&gt;/&lt;settlement_id&gt;
            </code> convention.</p>
            <p>These routes are private and require authentication.</p>

            <p>Many operations below require asset handles.
            Asset handles may be found in the settlement's <code>game_assets</code>
            element, which contains dictionaries and lists of assets that are
            available to the settlement based on its campaign, expansions, etc.</p>
            <p>Typical settlement JSON looks like this:</p>
            <pre><code>
            {
                "user_assets": {...},
                "meta": {...},
                "sheet": {...},
                "game_assets": {
                    "milestones_options": {...},
                    "campaign": {...},
                    "weapon_specializations": {...},
                    "locations": {...},
                    "innovations": {...},
                    "principles_options": {...},
                    "causes_of_death": {...},
                    "quarry_options": {...},
                    "nemesis_options": {...},
                    "eligible_parents": {...},
                    ...
                },
            }
            </code></pre>

            <p><b>Important!</b> As indicated elsewhere in this documentation,
            asset handles will never change. Asset names are subject to change,
            and, while name-based lookup methods are supported by various routes,
            using names instead of handles is not recommended.</p>
            </th>
        </tr>
 

        <!-- settlement <b>GET</b> -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Settlement data retrieval:</b>
            The routes in this section only support the <b>GET</b> method and are meant
            to be used to retrieve certain types of Settlement data. </td>
        </tr>

        <tr class="ul">
            <td> /settlement/get/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td> <p> Retrieve a serialized version of the settlement associated
            with &lt;settlement_id&gt; (to include all related user and game
            assets, including survivors).</p>
            <p><b>Important!</b> Depending on the number of expansions, survivors,
            users, etc. involved in a settlement/campaign, this one can take a
            long time to come back (over 2.5 seconds on Production hardware).
            YHBW</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_game_assets/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td><p>Retrieve a serialized version of just the settlement that only
            includes the settlement's <code>game_assets</code> element.
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_sheet/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td><p>Retrieve a serialized version of just the settlement that only
            includes the <code>sheet</code> element.
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_summary/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td>
                <p>Get a nice, dashboard-friendly summary of a settlement's info.</p>
                <p>This route is optimized for speedy returns, e.g. the kind you
                want when showing a user a list of their settlements.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_campaign/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td><p>Retrieve a serialized version of the settlement where the
            <code>user_assets</code> element includes the <code>groups</code>
            list, among other things, and is intended to be used in creating
            'campaign' type views.</p>
            <p>Much like the big <code>get</code> route for settlements, this one
            can take a while to come back, e.g. two or more seconds for a normal
            settlement. YHBW.</p>
            </td>
        </tr>
        <tr>
            <td class="subsection_header" colspan="3"><b>Auxiliary ettlement 'get' routes:</b>
            attributes such as Survival Limit, Population and Death Count are more
            or less automatically tracked by the API, but you can use these routes
            to modify them directly, if necessary. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_event_log/&lt;settlement_id&gt; </td>
            <td> <b>GET</b>, <b>POST</b> </td>
            <td>
                <p><b>GET</b> this end point to retrieve all settlement event log
                entries (in a giant hunk of JSON) in <u>reverse chronological
                order</u>, i.e. latest first, oldest last.</p>
                <p>PROTIP: For higher LY settlements this can be a really huge
                list and take a long time to return: if you're a front-end
                developer, definitely consider loading this one AFTER you have
                rendered the rest of your view.</p>
                <p>Another way to optimize  here is to include a filter key/value
                pair in your <b>POST</b> body to limit your results. Some of the
                accepted filter params will decrease the time it takes for your
                requested lines to come back from the API:
                <table class="embedded_table">
                <tr><th>key</th><th>value type</th><th>scope</th>
                <tr>
                    <td class="small_key">lines</td>
                    <td class="type">arbitrary int</td>
                    <td class="value">Limit the return to the last <code>lines</code>-worth of lines: <code>{lines: 10}</code>. Note that this <u>does not</u> make the query or the return time better or faster for settlements with lots of event log lines.</td>
                </tr>
                <tr>
                    <td class="small_key">ly</td>
                    <td class="type">arbitrary int</td>
                    <td class="value">Limit the return to event log lines created <u>during</u> an arbitrary Lantern Year. <code>{ly: 9}</code>. Note:<ul><li>This will always return <i>something</i> and you'll get an empty list back for Lantern Years with no events.</li><li>This param triggers a performance-optimized query and will return faster than a general call to the endpoint with no params.</li></ul>
                </tr>
                <tr>
                    <td class="small_key">get_lines_after</td>
                    <td class="type">event log OID</td>
                    <td class="value">Limit the return to event log lines created <u>after</u> an event log OID: <code>{get_lines_after: "5a0370b54af5ca4306829050"}</code></td>
                </tr>
                <tr>
                    <td class="small_key">survivor_id</td>
                    <td class="type">arbitrary survivor's OID</td>
                    <td class="value">Limit the return to event log lines that are tagged with a survivor OID: <code>{survivor_id: "5a0123b54af1ca42945716283"}</code></td>
                </tr>
                </table>
                <p><b>Important!</b> Though the API will accept multiple filter
                params at this endpoint, <b>POST</b>ing more than one of the
                above can cause...unexpected output. YHBW.</p>
            </td>            
        </tr>
        <tr class="ul">
            <td> /settlement/get_storage/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td>
                <p>Hit this route to get representations of the settlement's
                storage.</p>
                <p>What you get back is an array with two dictionaries, one for
                resources and one for gear:</p>
                <pre><code>[
    {
        "storage_type": "resources",
        "total":0,
        "name":"Resource",
        "locations": [
            {
                "bgcolor":"B1FB17", 
                "handle":"basic_resources", 
                "name":"Basic Resources", 
                "collection": [
                    {
                        "handle":"_question_marks",
                        "name":"???",
                        "rules":[],
                        "consumable_keywords": ["fish","consumable","flower"],
                        "type_pretty": "Resources",
                        "keywords": ["organ","hide","bone","consumable"], 
                        "desc":"You have no idea what monster bit this is. Can be used as a bone, organ, or hide!",
                        "type":"resources", 
                        "sub_type":"basic_resources", 
                        "quantity":0,"flippers":false
                    },
                    ...
                ],
                ...
            },
    },
], </pre></code>
                <p>Each dictionary in the main array has an array called <code>
                locations</code>, which is a list of dictionaries where each dict
                is a possible location for gear or resources.</p>
                <p>Each <code>location</code> is an array of dictionaries
                representing places where a piece of gear or a resource can live,
                e.g. "White Lion Resources" or "Basic Gear", etc.</p>
                <p>Each location dictionary has an array called <code>collection
                </code> which is a list of dictionaries where each dictionary is
                a piece of gear or a resource. The attributes of these dictionaries
                include the <code>desc</code>, <code>quantity</code>, etc.</p>
            </td>
        </tr>


        <tr>
            <td class="subsection_header" colspan="3"><b>Settlement attributes:</b>
            attributes such as Survival Limit, Population and Death Count are more
            or less automatically tracked by the API, but you can use these routes
            to modify them directly, if necessary. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_name/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> some JSON whose body contains the key 'name' and whatever the
            new name is going to be as that key's value to change the settlement's
            name:</p>
            <code>{'name': 'The Black Lantern'}</code>
            <p><b>Important!</b> Submitting an empty string will cause the API to
            default the settlement's name to "UNKNOWN". There are no technical
            reasons (e.g. limitations) for this, but it breaks the display in most
            client apps, so null/empty names are forbidden.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_attribute/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> some basic JSON containing an 'attribute' and a 'value'
            key where 'attribute' is an integer settlement attrib and 'value' is
            the new value:</p>
            <code>{'attribute': 'survival_limit', 'value': 3}</code>
            <p> This route also supports incrementing the <code>population</code>
             and <code>death_count</code> attributes. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_attribute/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> some JSON containing an 'attribute' and a 'modifier'
            key where 'attribute' is an integer settlement attrib and 'mofier' is
            how much you want to increment it by:</p>
            <code>{'attribute': 'death_count', 'modifier': -1}</code>
            <p> This route also supports incrementing the <code>survival_limit
            </code> and <code>death_count</code> routes.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_population/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> some JSON containing the key 'modifier' whose value is
            an integer that you want to add to the settlement's population
            number.<p>
            <p>This works basically identically to the <code>update_attribute</code>
            route, so considering using that route instead. </p>
            <p>For example, this JSON would add two to the settlement's
            population number:</p>
            <code>{'modifier': 2}</code>
            <p><b>POST</b> negative numbers to decrease.</p>
            <p><b>Important!</b> Settlement population can never go below zero,
            so any 'modifier' values that would cause this simply cause the
            total to become zero.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_survivors/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Use this route to update a specific group of survivors, e.g.
                Departing survivors.</p>
                <p><b>POST</b> some JSON including the type of survivors to include,
                the attribute to modify, and the modifier:</p>
                <code>{include: 'departing', attribute: 'Insanity', modifier: 1}</code>
                <p><b>Important!</b> This route currently only supports the
                <code>include</code> value 'departing' and will error/fail/400 on
                literally anything else.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_inspirational_statue/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Set the settlement's <code>inspirational_statue</code> attrib
                by <b>POST</b>ing a Fighting Art handle to this route:</p>
                <code>{'handle': 'leader'}</code>
                <p>This route will actually check out the handle and barf on you
                if you try to <b>POST</b> an unrecognized FA handle to it. YHBW.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_lantern_research_level/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Set the Settlement's Lantern Research Level with some basic
                JSON:</p>
                <code>{'value': 3}</code>
                <p>This route is preferably to a generic attribute setting route
                becuase it a.) ignores values over 5 and b.) forces the attrib,
                which is not part of the standard data motel, to exist if it does
                not.</p>
                <p>Definitely use this instead of <code>set_attribute</code>.</p>
            </td>
        </tr>


        <!-- expansion controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Expansion content
            management:</b> add and remove expansion content. These methods
            require posting lists of expansion content handles. </td>
        </tr>

        <tr class="ul">
            <td> /settlement/add_expansions/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> Add expansions to a settlement by <b>POST</b>ing a list of expansion
            handles. The body of your post should be a JSON-style list: 
            <code>{'expansions': ['beta_challenge_scenarios','dragon_king']}</code>
            <p>
            Note that this route not only updates the settlement sheet, but also
            adds/removes timeline events, updates the settlement's available game
            assets (e.g. items, locations, etc.).
            </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_expansions/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> Remove expansions from a settlement by <b>POST</b>ing a list of
            expansion handles. The body of your post should be a JSON-style 
            list: 
            <code>{'expansions': ['manhunter','gorm','spidicules']}</code>
            <p>
            Note that this route not only updates the settlement sheet, but also
            adds/removes timeline events, updates the settlement's available game
            assets (e.g. items, locations, etc.).
            </p>
            <p><b>Important!</b> We're all adults here, and the KDM API will
            <i>not</i> stop you from removing expansion handles for expansions
            that are required by your settlement's campaign. If you want to
            prevent users from doing this, that's got to be part of your UI/UX
            considerations.</p>
            </td>
        </tr>

        
        <tr>
            <td class="subsection_header" colspan="3">
                <p><b>Game Asset management:</b> use the methods below to update
                list-/array-type attributes of the Settlement that contain game
                asset handles, e.g. <code>locations</code>, <code>innovations</code>
                and similar.
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/replace_game_assets/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This route accepts a list of handles and a type of game asset
                and then evalutes the settlement's current handles of that type,
                removing and adding as necessary in order to bring the settlement's
                list in sync with the incoming list. </p>
                <p>Your POST body needs to define the attribute <code>type</code>
                you're trying to update, as well as provide a list of handles
                that represent the settlement's current asset list:</p>
                <pre><code>{
    "type": "locations",
    "handles": [
        "lantern_hoard","bonesmith","organ_grinder"
    ]
}</code></pre>
                <p>Finally, a couple of tips/warnings on this route:<ul>
                    <li>The <code>handles</code> list/array is handled by the API
                    as if it were a set, i.e. duplicates are silently ignored.</li>
                    <li>If any part of the update fails (i.e. individual add
                    or remove operations), the whole update will fail and <u>
                    no changes to the settlement will be saved</u>.</li>
                    <li>This route does not support Location or Innovation
                    levels! (Use <code>set_location_level</code> or <code>
                    set_innovation_level</code> for that.)</li>
                </ul></p>
            </td>
        </tr>

        <!-- monster controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Monster management:</b>
            update the settlement's quarries, current quarry, nemesis info,
            etc. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_current_quarry/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>This route sets the settlement's 'current_quarry' attribute,
            which is the monster that the settlement's Departing Survivors are
            currently hunting.</p><p><b>POST</b> some simple JSON containing a monster
            name (do not use handles for this):</p>
            <code>{'current_quarry': 'White Lion Lvl 2'}</code>
            <p>...or, the monster is unique:</p>
            <code>{'current_quarry': 'Watcher'}</code>
            <p><b>Important!</b> You're typically going to want to pull monster
            names from the settlements' <code>game_assets -> defeated_monsters</code>
            list (which is a list of monster names created for the settlement
            based on expansion content, etc.)</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_defeated_monster/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> a 'monster' string to this route to add it to the
            settlement's list of defeated monsters:</p>
            <code>{'monster': 'White Lion (First Story)}</code> or
            <code>{'monster': 'Flower Knight Lvl 1'}</code>
            <p><b>Important!</b> Watch the strings on this one and try to avoid
            free text: if the API cannot parse the monster name and match it to
            a known monster type/name, this will fail.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_defeated_monster/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> a 'monster' string to this route to remove it from the
            settlement's list of defeated monsters, i.e. the <code>sheet.defeated_monsters</code>
            array/list: </p>
            <code>{'monster': 'Manhunter Lvl 4'}</code>
            <p>Attempts to remove strings that do NOT exist in the list will
            not fail (i.e. they will be ignored and fail 'gracefully').</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_monster/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <P>Use this route to add quarry or nemesis type monsters to the
            settlement. <b>POST</b> some JSON containing the handle of the monster to
            add it:</p>
            <code>{'handle': 'flower_knight'}</code>
            <p>The API will determine whether the monster is a nemesis or a quarry
            and add it to the appropriate list. For nemesis monsters, use the
            <code>/settlement/update_nemesis_levels</code> route (below) to manage
            the checked/completed levels for that nemesis.</p>
            <p>Make sure to check the settlement JSON <code>game_assets.monsters</code>
            and use the correct handle for the desired monster.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_monster/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> some JSON containing a quarry or nemesis type monster handle
            to remove it from the settlement's list:</p>
            <code>{'handle': 'sunstalker'}</code>
            <p>The API will determine whether the monster is a quarry or a nemesis.
            When a nemesis monster is removed, its level detail is also removed.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_nemesis_levels/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
             <p>Use this method to update the Settlement sheet's <code>nemesis_encounters</code>
             dictionary, i.e. to indicate that a nemesis encounter has occurred.</p>
             <p>A typical dictionary might look like this:</p>
             <code>        "nemesis_encounters": {"slenderman": [], "butcher": [1,2]}</code>
             <p>In this example, the settlement has (somehow) encountered a
             a level 1 Butcher, but has not yet encountered a Slenderman.</p>
             <p>To update the dictionary, <b>POST</b> some JSON that includes the
             nemesis monster's handle and the levels that are complete.</p>
             <p><b>POST</b> this JSON to reset/undo/remove Butcher encounters:<p>
             <code>{"handle": "butcher", "levels": []}</code>
             <p><b>POST</b> this JSON to record an encounter with a level 1 Manhunter:</p>
             <code>{"handle": "manhunter", "levels": [1]}</code>
            </td>
        </tr>

        <!-- principle/milestone -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Principles and Milestones:</b>
            routes for setting/unsetting principles and settlement Milestones.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_milestone/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> a milestone handle (get it from <code>game_assets</code>
                to this route to add it to the settlement's list of milestones:</p>
                <code>{handle: 'game_over'}</code><p>...or...</p>
                <code>{handle: 'innovations_5'}
                <p>This endpoint will gracefully fail and politely ignore dupes.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_milestone/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> a milestone handle (get it from <code>game_assets</code>
                to this route to remove it from the settlement's list of
                milestones:</p>
                <code>{handle: 'pop_15'}</code><p>...or...</p>
                <code>{handle: 'first_death'}
                <p>This endpoint will gracefully fail and politely ignore
                attempts to remove handles that are not present.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_principle/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> some JSON to this route to set or unset a settlement
            principle. Request the handle of the principle and the election you
            want to make:</p>
            <pre><code>
            {
                'principle': 'conviction',
                'election': 'romantic',
            }</code></pre>
            <p>This route has a couple of unusual behaviors to note:
            <ul>
                <li>It requires both keys (i.e. you will get a 400 back if you
                <b>POST</b> any JSON that does not include both).</li>
                <li>It will accept a Boolean for 'election', because this is how
                you 'un-set' a principle.</li>
            </ul>
            </p>
            <p> To un-set a principle, simply post the principle handle and set
            the 'election' key to 'false':</p>
            <code>{'principle': 'new_life', 'election': false}</code>
            <p> <b>Important!</b> Adding principles to (or removing them from) a
            settlement automatically modifies all current survivors, in many
            cases. Be sure to refresh any survivor info after <b>POST</b>ing JSON to
            this route!</p>
            </td>
        </tr>


        <!-- location controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Locations:</b>
            manage settlement locations and location levels.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_location/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p> <b>POST</b> a location <code>handle</code> to this route to add
            it to the settlement's Locations:</p>
            <code>{'handle': 'bone_smith'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_location/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>This is basically the reverse of <code>add_location</code>
            and works nearly identically. <b>POST</b> a JSON representation of a 
            Location handle to remove it from the settlement's list:</p>
            <code>{'handle': 'barber_surgeon'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_location_level/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>For Locations that have a level (e.g. the People of the 
            Sun's 'Sacred Pool'), you may set the Location's level by posting
            the <code>handle</code> of the location and the desired level:</p>
            <code>{'handle': 'sacred_pool', 'level': 2}</code>
            </td>
        </tr>


        <!-- Innovation controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Innovations:</b>
            manage settlement innovations and innovation levels.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_innovation_deck/&lt;settlement_id&gt; </td>
            <td> <b>GET, POST</b> </td>
            <td>
                <p>Retrieve the settlement's current innovation deck as an array
                of asset names by default.</p>
                <p>Alternately, you can <b>POST</b> the parameter
                <code>return_type: "dict"</code> to this endpoint to get a hash
                of innovations (representing the settlement's Innovation Deck)
                back from this endpoint.</p>
                <p>In the hash, innovation assets are sorted by their name (i.e.
                <i>not</i> by their handle):<p>
                <pre><code>{
    "albedo": {
        "handle": "albedo",
        "name": "Albedo",
        "consequences": [
            "citrinitas"
        ],
        "endeavors": [
            "gorm_albedo"
        ],
        "expansion": "gorm",
        "type_pretty": "Innovations",
        "sub_type_pretty": "Expansion",
        "type": "innovations",
        "sub_type": "expansion",
        "innovation_type": "science"
    },
    "bed": {
        "handle": "bed",
        "name": "Bed",
        "type": "innovations",
        "endeavors": [
            "bed_rest"
        ],
        "type_pretty": "Innovations",
        "sub_type_pretty": "Innovation",
        "survival_limit": 1,
        "sub_type": "innovation",
        "innovation_type": "home"
    },
    ...
    "symposium": {
        "handle": "symposium",
        "name": "Symposium",
        "consequences": [
            "nightmare_training",
            "storytelling"
        ],
        "type": "innovations",
        "settlement_buff": "When a survivor innovates, draw an additional 2 Innovation Cards to choose from.",
        "type_pretty": "Innovations",
        "sub_type_pretty": "Innovation",
        "survival_limit": 1,
        "sub_type": "innovation",
        "innovation_type": "education"
    }
}
</code></pre>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_innovation/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p> <b>POST</b> an Innovation <code>handle</code> to this route to add
            it to the settlement's Innovations:</p>
            <code>{'handle': 'hovel'}</code>
            <p>...or:</p><code>{'handle': 'mastery_club'}</code>
            <p><b>Important!</b> As far as the API is concerned, Principles (e.g.
            'Graves', 'Survival of the Fittest', etc. <u>are not innovations</u>
            and you <u>will</u> break the website if you try to add a principle
            as if it were an innovation.</p>
            <p>Use <code>set_principle</code> (below) instead.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_innovation/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>This is basically the reverse of <code>add_innovation</code>
            and works nearly identically. <b>POST</b> a JSON representation of an 
            Innovation handle to remove it from the settlement's list:</p>
            <code>{'handle': 'mastery_club'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_innovation_level/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>For Innovations that have a level (e.g. the Slenderman's 'Dark
            Water Research'), you may set the Innovation's level by posting
            the <code>handle</code> of the innovation and the level:</p>
            <code>{'handle': 'dark_water_research', 'level': 2}</code>
            </td>
        </tr>


        <!-- timeline controls -->
        <tr>
            <td class="subsection_header" colspan="3">
                <a id="timelineDataModel"></a> 
                <p><b>Timeline 1.2 controls:</b>
                use these routes to manage the settlement's timeline. Make sure you
                you are familiar with the data model for the timeline (documented
                in the paragraphs below) before using these routes.</p>
                <p>At the highest level, every settlement's <code>sheet.timeline</code>
                element is a list of hashes, where each hash represents an individual
                lantern year.</p>
                <p>Within each Lantern Year, the keys's values are lists of events, except
                for the <code>year</code> key, which is special because it is the only
                key in the Lantern Year hash whose value is an integer, instead of a list.</p>
                <p>The other keys in the hash, the ones whose values are lists of events,
                have to be one of the following:<ul>
                    <li><code>settlement_event</code></li>
                    <li><code>story_event</code></li>
                    <li><code>special_showdown</code></li>
                    <li><code>nemesis_encounter</code></li>
                    <li><code>showdown_event</code></li>
                    </ul>
                Individual events are themselves hashes. In the 1.2 revision of the
                timeline data model, individual event hashes have a single key/value
                pair: they either have a <code>handle</code> key, whose value is an 
                event handle (e.g. from the settlement JSON's <code>game_assets.events
                </code> element) or a a <code>name</code> key, whose value is an
                arbitrary string.</p>
                <p>In generic terms, here is how a settlement's <code>
                sheet.timeline</code> JSON is structured:</p>
                    <pre><code>
[
    {
        year: 0,
        showdown_event: [{name: 'name'}],
        story_event: [{handle: 'handle'}]
    },
    {year: 1, special_showdown: [{name: 'name'}], settlement_event: [{handle: 'handle'}]}
    {year: 2, }
    {year: 3, nemesis_encounter: [{name: 'name'}, {name: 'name'}], story_event: [{name: 'name'}, {handle: 'handle'}]}
    ...
]</code></pre>
                <p><b>Important!</b> Individual Lantern Year hashes need not
                contain any event list hashes, but they <u>absolutely must contain a
                hash with the <code>year</code> key/value pair.</u></p>
                <p>Any attempt to <b>POST</b> a Lantern Year without this 'magic'
                key/value pair, e.g. using the <code>replace_lantern_year</code>
                route below, will cause the API to throw an error.</p>
                <p>Also, for now, the API does not enforce any normalization or business logic
                for the timeline and individual event lists may contain as many
                event hashes as necessary.</p>
                <p>Finally, the API should <b>always</b> render the list of Lantern
                Year hashes (i.e. <code>sheet.timeline</code> in "chronological"
                order. If you get them back out of order, open a ticket.</p>
        </tr>
        <tr class="ul">
            <td> /settlement/get_timeline/&lt;settlement_id&gt; </td>
            <td> <b>GET</b> </td>
            <td>
                <p>Hit this endpoint to get a JSON representation of the
                settlement's timeline.</p>
                <p>This is read-only and optimized for performance, so you'll
                get a timeline MUCH faster using this route than one of the
                routes that pulls down the whole settlement.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_lantern_years/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> a number (int) of years to add to the settlement's
                Timeline:</p>
                <code>{years: 5}</code>
                <p><b>NB:</b> Timelines are capped at 50 LYs. If you try to add
                a number of years that would take you above 50 LYs, you'll get a
                400 back.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_timeline_event/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>As of March 2018, <b>this endpoint is deprecated and is no
                longer supported.</b></p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_timeline_event/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>As of March 2018, <b>this endpoint is deprecated and is no
                longer supported.</b></p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/replace_lantern_year/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This is the preferred route for adding or removing events
                from a Lantern year. It basically requires <b>POST</b>ing an
                entire Lantern Year to the API, so be sure to understand the
                <a href="#timelineDataModel">timeline data model</a> before
                attempting to use this one.</p>
                <p>Since a Lantern year is a hash of hashes, replacing one is
                as simple as <b>POST</b>ing that hash to this route. To "blank
                out" or remove all events from an LY, for example, you would
                simply send a <b>POST</b> body like this:</p>
                <code>{ly: {year: 5}}</code>
                <p>Similarly, to add events to that LY, you could <b>POST</b>
                something like this:</p>
                <code>{ly: {year: 5, settlement_event: [{handle: 'core_open_maw', handle: 'core_clinging_mist'}]}</code>
                <p>Finally, as the name suggests, this is an overwrite/replace
                type method, and it does not do any "checks" or comparisons
                between the data in the API and your incoming LY.</p>
                <p>The best practice here, from a design standpoint, is to pull
                down the settlement's timeline (e.g. using <code>get_timeline</code>
                (above), let the user modify an individual LY as necessary, and
                then to <b>POST</b> their modified LY back, in its entirety, to
                this endpoint.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_current_lantern_year/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>To set the settlement's current LY, <b>POST</b> an int to this
                endpoint:</p>
                <code>{ly: 3}</code>
            </td>
        </tr>



        <!-- misc -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Other:</b>
            update the settlement's endeavor token count, lost settlements and
            other miscellaneous Settlement attributes. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_endeavor_tokens/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
            <p>Use this route to change a settlement's endeavor token count.</p>
            <p><b>POST</b> some JSON containing the number to modify by:</p>
            <code>{"modifier": 2}</code>
            <p>The above code would add two to the settlement's current total,
            whereas the code below would decrement by one:</p>
            <code>{"modifier": -1}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_lost_settlements/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
            <p>Use this route to set a settlement's Lost Settlements total.</p>
            <p><b>POST</b> some JSON containing the new value to set it to:</p>
            <code>{"value": 2}</code>
            <p>The above code would set the settlement's Lost Settlements total
            to two; negative numbers will default to zero. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/toggle_strain_milestone/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>You may <b>POST</b> some JSON containing the key <code>handle</code>
                and the value of a strain milestone handle to toggle that strain
                milestone on or off for the settlement:</p>
                <code>{"handle": "ethereal_culture_strain"}</code>
                <p>The API will fail if unknown <code>handle</code> values are <b>POST</b>ed.</p>
            </td>
        </tr>


        <!-- meta updates, e.g. logs, notes, etc. -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Meta and admin controls:</b>
            manage settlement meta data, including adding/removing settlement notes,
            changing the list of settlement admins, etc. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_admin/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> the email address of a registered user to add them to the
                list of settlement administrators:</p>
                <code>{login: 'demo@kdm-manager.com'}</code>
                <p>Disclaimers:<ul><li>This will fail gracefully if the user's
                email is in the list (so feel free to spam it).</li><li>This will
                fail loudly if the email address does not belong to a registered
                user: you'll get a 400 and a nasty message back.</li></ul>
                </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_admin/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This is the reverse of the <code>add_admin</code> route.</p>
                <p>Basically, you <b>POST</b> some JSON to the route including the email
                of the user you want to remove from the settlement admins list:</p>
                <code>{login: 'demo@kdm-manager.com'}</code>
                <p>Like the <code>add_admin</code> route, this one fails gracefully
                if you try to remove someone who isn't on the list, etc.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_note/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Since any player in a game is allowed to create settlement
                notes, the JSON required by this endpoint must include a user's
                OID.</p>
                <p>This endpoint supports the following key/value pairs:</p>
                <table class="embedded_table">
                    <tr><th>key</th><th><b>R</b>/O</th><th>value</th></tr>
                    <tr>
                        <td class="small_key">author_id</td>
                        <td class="type"><b>R</b></type>
                        <td class="value">The creator's OID as a string.</td>
                    </tr>
                    <tr>
                        <td class="small_key">note</td>
                        <td class="type"><b>R</b></type>
                        <td class="value">The note as a string. We accept HTML here, so if you want to display this back to your users as HTML, you can do that.</td>
                    </tr>
                    <tr>
                        <td class="small_key">author</td>
                        <td class="type">O</type>
                        <td class="value">The creator's login, e.g. <code>demo@kdm-manager.com</code>, as a string. Best practice is to NOT include this, unless you really know what you're doing.</td>
                    </tr>
                    <tr>
                        <td class="small_key">lantern_year</td>
                        <td class="type">O</type>
                        <td class="value">The Lantern Year the note was created. Defaults to the current LY if not specified.</td>
                    </tr>
                </table>
                <p>For example, to add a new note to a settlement, your <b>POST</b>
                body will, at a minimum, look something like this:</p>
                <code>{author_id: "5a26eb1a4af5ca786d1ed548", note: "Nobody expects the Spanish Inquisition!"}</code>
                <p><b>Important!</b> This route returns the OID of the
                newly-created note:</p>
                <code>{"note_oid": {"$oid": "5a2812d94af5ca03ef7db6c6"}}</code>
                <p>...which can then be used to remove the note, if necessary
                (see <code>rm_note</code> below).</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_note/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> the OID of a settlement note to remove it.</p>
                <code>{_id: "5a26eb894af5ca786d1ed558"}</code>
                <p>As long as you get a 200 back from this one, the note has
                been removed. If you get a non-200 status (literally anything other
                than a 200), something went wrong. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_last_accessed/&lt;settlement_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>This endpoint allows you to set the settlement's <code>last_accessed</code>
            attribute, which is used in dashboard reporting, etc. </p>
            <p><b>POST</b>ing an empty JSON payload to this will cause the settlement's <code>
            last_accessed</code> value to be set to now.</p>
            </td>
        </tr>
        <tr class="ul">
            <td>
                <a id="settlementAbandon"></a> 
                /settlement/abandon/&lt;settlement_id&gt;
            </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Hit this route with a <b>POST</b> to mark the settlement as abandoned.</p>
                <p>Your <b>POST</b> does not need to contain anything (but it does need
                to be a <b>POST</b> (<b>GET</b> requests will not abandon the settlement.</p>
                <p>An abandoned settlement has a date/time stamp of when it was
                abandoned as its <code>abandoned</code> attribute.</p>
            </td>
        </tr>
        <tr class="ul">
            <td>
                <a id="settlementRemove"></a> 
                /settlement/remove/&lt;settlement_id&gt;
            </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> (not <b>GET</b>) to this route to mark the
                settlement as removed.</p>
                <p>Once marked as removed, settlements are queued up by the API
                for removal from the database: the next time the maintenance
                process runs, it will check the timestap of the mark as removed
                event and purge the settlement (and all survivors) from the
                database.</p>
                <p><b>This cannot be undone.</b></p>
            </td>
        </tr>




        <tr class="ul route_root">
            <th colspan="3">
                <a id="survivorDataModel"></a>
                <p> <b>Survivor Routes:</b> all routes for working directly with
                an individual survivor follow a <code>
                /settlement/&lt;action&gt;/&lt;settlement_id&gt;</code> convention.</p>

                <p>Like settlement management routes, these routes are private, require
                authentication and accept the <code>OPTIONS</code> requests method.</p>

                <p><b>Important!</b> Any <b>POST</b> to any of these routes can also
                include the optional parameter <code>{"serialize_on_response": true}
                </code>. Including this param will get you a serialized version
                of the survivor as part of your response.</p>

            </th>
        </tr>

        <tr>
            <td class="subsection_header" colspan="3"><b>Survivor Data Model:</b><br/><br/>
                <table class="data_model_table">
                <tr><th>key</th><th>R/O</th><th>&nbsp; type &nbsp;</th><th width="40%">description</th><th>related endpoints</th></tr>
                <tr><td class="key">email</td><td>O</td><td>str</td><td>Defaults to the creator's login.</td><td class="mono">set_email</td></tr>
                <tr><td class="key">born_in_ly</td><td>O</td><td>int</td><td>Defaults to the settlement's current LY.</td><td></td></tr>
                <tr><td class="key">settlement</td><td><b>R</b></td><td>OID</td><td>This must be set to a valid settlement OID at creation time and <u>can never be changed</u>. See <a href="#newSurvivor"><code>/new/survivor</code></a> above for more info on creating survivors.</td><td class="mono"></td><td></td></tr>
                <tr><td class="key">public</td><td>O</td><td>bool</td><td>Defaults to Boolean false. Submitting anything that evaluates to Boolean true will be treated as such.</td><td class="mono">toggle_boolean</td></tr>
                <tr><td class="key">name</td><td>O</td><td>str</td><td></td><td class="mono">set_name</td></tr>
                <tr><td class="key">sex</td><td>O</td><td>str</td><td>At creation time, this can be set to 'M', 'F' or 'R' (for random). Defaults to 'R' during creation if not specified in the <b>POST</b> body.</td><td class="mono">set_sex</td></tr>
                <tr><td class="key">survival</td><td>O</td><td>int</td><td></td><td class="mono">update_survival set_survival</td></tr>
                <tr><td class="key">hunt_xp</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Insanity</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Head</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Arms</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Body</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Waist</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Legs</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Courage</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Understanding</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">affinities</td><td>O</td><td>dict</td><td>Rather than setting this at creation time, consider using <code>upfate_affinities</code> route after creation to set this, unless you really know what you're doing</td><td class="mono">update_affinities set_affinity</td></tr>
                <tr><td class="key">departing</td><td>O</td><td>bool</td><td></td><td class="mono">set_status_flag</td></tr>
                <tr><td class="key">bleeding_tokens</td><td>O</td><td>int</td><td></td><td class="mono">update_bleeding_tokens set_bleeding_tokens</td></tr>
                <tr><td class="key">max_bleeding_tokens</td><td>O</td><td>int</td><td>Defaults to 5.</td><td class="mono">set_attribute</td></tr>
                <tr><td class="key">Movement</td><td>O</td><td>int</td><td>Defaults to 5.</td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Accuracy</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Strength</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Evasion</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Luck</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Speed</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">attribute_detail</td><td>O</td><td>dict</td><td></td><td class="mono">set_attribute_detail</td></tr>
                <tr><td class="key">Weapon Proficiency</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">weapon_proficiency_type</td><td>O</td><td>str</td><td>handle</td><td class="mono">set_weapon_proficiency_type</td></tr>
                <tr><td class="key">abilities_and_impairments</td><td>O</td><td>list</td><td>Needs a list of handles from the settlement's <code>game_assets</code> element, e.g. <code>{'abilities_and_impairments': ['ageless','mastery_sword']}</code> or similar.</td><td class="mono">add_game_asset rm_game_asset</td></tr>
                <tr><td class="key">cursed_items</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_cursed_item rm_cursed_item</tr>
                <tr><td class="key">disorders</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_game_asset, rm_game_asset</td></tr>
                <tr><td class="key">favorite</td><td>O</td><td>list</td><td>list of user emails, i.e. users who have favorited the survivor</td><td class="mono">add_favorite rm_favorite</td></tr>
                <tr><td class="key">fighting_arts</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_game_asset rm_game_asset</td></tr>
                <tr><td class="key">fighting_arts_levels</td><td>O</td><td>list</td><td>dictionary where each key is a Fighting Art handle whose value is an array, e.g. <code>{'silk_surgeon': [1,2]}</code></td><td class="mono">toggle_fighting_arts_level</td></tr>
                <tr><td class="key">epithets</td><td>O</td><td>list</td><td>list of handles</td><td class="mono">add_game_asset rm_game_asset</td></tr>
                </table>

                <p><b>Important!</b> There are certain endpoints below that may
                add additional attributes to a survivor record, e.g. <code>
                controls_of_death</code>, <code>set_retired</code>, etc.</p>

                <p>Attributes such as <code>dead</code> and <code>retired</code>
                are not part of the baseline data model, i.e. they are not part
                of the survivor record when it is created. YHBW</p>

            </td>
        </tr>

        <tr>
            <td class="subsection_header" colspan="3"><b><b>GET</b> routes:</b>
            retrieve various types of survivor data.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/get/&lt;survivor_id&gt; </td>
            <td> <b>GET</b> </td>
            <td> Retrieve a serialized version of the survivor.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/remove/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> 
                <p>Marks a survivor as "removed", which queues them up for trash
                collection (i.e. final deletion from the database).</p>
                <p><b>Removed survivors cannot be restored or recovered.</b></p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a id="getAvatarAnchor">/avatar/get/&lt;avatar_oid&gt;</a> </td>
            <td> <b>GET</b> </td>
            <td>
                <p>This route does one thing: it <b>GET</b>s survivor avatars
                based on their OID and 'serves' them like a webserver would
                serve them from a filesystem.</p>
                <p>The route won't take a <b>POST</b>, it won't take params,
                etc. If successful, it will return 200 with an <code>image/png</code>
                mimetype of your avatar.</p>
                <p>Formulate your URL thus:</p>
                <code>https://api.thewatcher.io/avatar/get/5b080f754af5ca68d266b9d5</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/get_lineage/&lt;survivor_id&gt; </td>
            <td> <b>GET</b> </td>
            <td> <p>Retrieve a dictionary of survivor family info.</p>
            <p>This method can take a minute to return, as it does recursion,
            initializes all surviviors, living and dead, etc. It's probably
            a good idea to use this one with a loading graphic, etc.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/get_survival_actions/&lt;survivor_id&gt; </td>
            <td> <b>GET</b> </td>
            <td> <p>Retrieve JSON representing the Survival Actions currently
            available to the survivor: </p>
            <pre><code>
    [
        {
            "available": false,
            "sort_order": 0,
            "handle": "dodge",
            "name": "Dodge",
            "type": "survival_action",
            "title_tip": "Impairment 'Broken hip' prevents Wallace from using this ability."
        },
        {
            "available": true,
            "handle": "embolden",
            "name": "Embolden",
            "sort_order": 2,
            "type": "survival_action",
            "title_tip": "Settlement innovation 'Sun Language' unlocks this ability."
        },
        {
            "available": false,
            "handle": "overcharge",
            "name": "Overcharge",
            "sort_order": 5,
            "type": "survival_action",
            "title_tip": "Not unlocked."
        }
    ]</code></pre>
            <p>This JSON is updated automatically whenever the
            the settlement's innovations are update or the survivor's abilities
            are updated.</p>
            </td>
        </tr>


        <!-- asset mgmt -->
        <tr>
            <td class="subsection_header" colspan="3"><p><b>Asset management:</b>
            routes for adding, removing and modifying Survivor Sheet game asset
            info, e.g. Fighting Arts, Disorders, Abilities & Impairments, etc.</p>
            <p><b>Important!</b> Most of these routes have back-end business logic
            "baked" into them, so it is <u>highly recommended</u> that you reload/re-get
            your survivor's JSON after <b>POST</b>ing commands to these routes!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_game_asset/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Use this route to add an asset 'handle' of whatever 'type'
            to a survivor.</p>
            <p>Requires both the 'handle' and 'type' keys:</p>
            <code>{'handle': 'blind', 'type': 'abilities_and_impairments'}</code>
            <code>{'handle': 'crossarm_block', 'type': 'fighting_arts'}</code>
            <p><b>Important!</b> This method enforces many of the incoming
            asset's attributes, including <code>max</code>, <code>epithet</code>,
            and so on.</p>
            <p>PROTIP: if you want the API to assign a random, eligible asset to
            the survivor, use the bogus/magic handle "_random" instead of a
            handle from the settlement's <code>game_assets</code>.</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_game_asset/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>The exact inverse of <code>add_game_asset</code>, <b>POST</b>ing to
            this route requires both 'handle' and 'type' keys and removes a game
            asset handle from a survivor. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_many_game_assets/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This route allows you to add or remove multiple game assets
                from a survivor by <b>POST</b>ing a list of handles/types, as if you
                were doing many <code>add_game_asset</code> or <code>rm_game_asset</code>
                operations serially.</p>
                <p>The JSON you have to <b>POST</b> must include the action you want to
                take:</p>
                <pre><code>{
    "action": "rm",
    "game_assets": [
        {"type": "abilities_and_impairments", "handle": "blind"},
        {"type": "fighting_arts", "handle": "crossarm_block"}
    ]
}</code></pre>
                <p><b>Important!</b> As with <code>set_many_attributes()</code>,
                the hashes in the <code>game_assets</code> list are pressed in
                the order you <b>POST</b> them. YHBW.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/replace_game_assets/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This route accepts a list of handles and a type of game asset
                and then evalutes the survivor's current handles of that type,
                removing and adding as necessary in order to bring the survivor's
                list in sync with the incoming list. </p>
                <p>Your JSON should look basically like this:</p>
                <pre><code>{
    "type": "abilities_and_impairments",
    "handles": [
        "bitter_frenzy","ageless","analyze"
    ]
}</code></pre>
                <p>You're going to want to also include <code>{"serialize_on_response": true}</code>
                in your <b>POST</b> body on this one, because your survivor is DEFINITELY
                going to come back way different than he was before you did this.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_cursed_item/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> a cursed item 'handle' to this route to add that cursed
            item to the survivor:</p>
            <code>{'handle': 'thunder_maul'}</code>
            <p><b>Important!</b> This will automatically apply any A&Is and
            epithets related to the curse to the survivor.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_cursed_item/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> a cursed item 'handle' to this route to remove that
            cursed item from the survivor:</p>
            <code>{'handle': 'husk_of_destiny'}</code>
            <p><b>Important!</b> This will automatically apply remove any epithets
            A&Is, etc. from the survivor (but will not remove any that are still
            effective, e.g. because another cursed item also requires them.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_partner/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> the OID of a survivor to this end point to make
                that survivor this survivor's partner:</p>
                <code>{partner_id: "5a53a2154af5ca67743c6c79"}</code>
                <p>To remove the survivor's partner, post the magic value 'UNSET'
                as the <code>partner_id</code>:</p>
                <code>{partner_id: "UNSET"}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_special_attribute/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Use this route to set a survivor special attribute to a
                Boolean value:</p>
                <code>{'handle': 'pots_purified', 'value': false}</code>
                <p>A couple of things to note here:
                <ul>
                    <li>The 'handle' will be validated and if you <b>POST</b> a bad/bogus
                    handle, you'll get a 400 (or worse).</li>
                    <li>The 'value' must be a Boolean/truthy/falsy type value.
                    Anything else will get you a 400 (probably a 500, tbh).</li>
                    <li>Once added to a survivor, this attribute is not removed,
                    so it will forever be a Boolean attrib of the survivor (i.e.
                    so feel free to reference it after setting it False, etc.).</li>
                </ul>
                </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_weapon_proficiency_type/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> some JSON containing a weapon proficiency type handle
                (from the settlement's <code>game_assets</code> to set it as the
                survivor's weapon type:</p>
                <code>{handle: 'sword'}</code>
                <p>To unset/remove weapon proficiency type from a survivor, <b>POST</b>
                they key <code>unset</code> to this endpoint:</p>
                <code>{unset: true}</code>
            </td>
        </tr>

        <!-- sheet attribs -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Sheet Attributes:</b>
            routes for updating Survivor Sheet attributes</td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_attribute/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p>Use this route to set an arbitrary survivor attribute to an
            arbitrary value. Requires 'attribute' and 'value' keys.<p>
            <p><b>POST</b> some JSON containing the 'attrib' name and the new 'value'
            like so:</p>
            <code>{'attribute': 'Strength', 'value': 3}</code>
            <p>The JSON above would set the survivor's Strength to three. The
            'value' should always be an integer. Negative numbers are supported:</p>
            <code>{'attribute': 'Evasion', 'value': -2}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_many_attributes/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>This one works similarly to <code>/survivor/set_attribute/&lt;survivor_id&gt;</code>
                or <code>/survivor/set_attribute_detail&lt;survivor_id&gt;</code>,
                except it can update a list of attribute/value pairs and/or
                a list of attribute/detail/value pairs.</p>
                <p>Assuming you want to update the base values as well as the
                details (i.e. attribute modifiers, in game parlance), the body
                of your <b>POST</b> should look something like this:</p>
                <pre><code>{
    attributes: [
        {attribute: 'Strength', value: 2},
        {attribute: 'survival', value: 5}
    ],
    attribute_details: [
        {'attribute': 'Luck', 'detail': 'tokens', 'value': 2},
        {'attribute': 'Strength', 'detail': 'gear', 'value': -1}
    ],
}</code></pre>
                <p><b>Important!</b> Since the <code>attributes</code> array will
                be processed as a Python <code>list</code> type object, attributes
                will be updated synchronously, in the order they are posted.</p>
                <p><b>Important!</b> Failures in this method <u>are not atomic</u>,
                which means that if one hash causes a failure, the whole request
                will fail and nothing will be saved!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_attribute_detail/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>All survivors have an <code>attribute_detail</code> element in
            their <code>sheet</code> JSON:</p>
            <code><pre>
        "attribute_detail": {
            "Strength": {
                "tokens": 0,
                "gear": 0
            },
            "Evasion": {
                "tokens": 0,
                "gear": 0
            },
            "Movement": {
                "tokens": 0,
                "gear": 0
            },
            "Luck": {
                "tokens": 0,
                "gear": 0
            },
            "Speed": {
                "tokens": 0,
                "gear": 0
            },
            "Accuracy": {
                "tokens": 1,
                "gear": 0
            }
        },</code></pre>
            <p>This is used to manage attribute info that is NOT the base
            attribute value (see <code>set_attribute</code> and <code>
            update_attribute</code> for updating base values).</p>
            <p>To update <code>attribute_detail</code> info, <b>POST</b> some JSON
            that includes an 'attribute', 'detail' and 'value':</p>
            <code>{'attribute': 'Luck', 'detail': 'tokens', 'value': 2}</code>
            <p>The sample code above would set the survivor's 'Luck' attribute
            detail for 'tokens' to two.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_attribute/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Supports arbitrary survivor attribute updates. Requires JSON
            contianing an 'attribute' and a 'modifier'. Adds the value of
            'modifier' to the current value of 'attribute'.</p>
            <p>Sample JSON to increase strength by two:</p>
            <code>{'attribute': 'Strength', 'modifier': 2}</code>
            <p>Sample JSON to decrease Insanity by 1:</p>
            <code>{'attribute': 'Insanity', 'modifier': -1}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_bleeding_tokens/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p> Use this to add an integer to the survivor's bleeding token
            count:</p>
            <code>{'modifier': -2}</code>
            <p><b>Important!</b> The API will never set the survivor's <code>
            bleeding_tokens</code> value lower than zero or higher than the
            survivor's <code>max_bleeding_tokens</code>. It will return 200's to
            requests that break these rules.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_bleeding_tokens/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p> Use this route to set the survivor's <code>bleeding_tokens</code>
            attribute to an arbitrary integer value.</p>
            <code>{'value': 4}</code>
            <p>Negative values will be ignored (and you'll get a 200 back).</p>
            <p><b>Important!</b> The API will never set the survivor's <code>
            bleeding_tokens</code> value lower than zero or higher than the
            survivor's <code>max_bleeding_tokens</code>. It will return 200's to
            requests that break these rules.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_name/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> some JSON containing the survivor's new name like so:</p>
            <code>{'name': 'Adam'}</code>
            <p><b>Important!</b> <b>POST</b>ing a blank string as the value of 'name'
            will result in the survivor's name defaulting to 'Anonymous':</p>
            <code>{'name': ''}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_retired/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td><p><b>POST</b> some JSON containing a Boolean value representing whether
            the survivor is retired or not:</p>
            <code>{'retired': true}</code>
            <p>The 'retired' value will be duck-typed to a Boolean, so posting
            anything that evaluates true (e.g. 'checked') will count as a Boolean
            true, for the intents and purposes of this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_sex/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Modify the survivor's sex by <b>POST</b>ing a simple JSON object
            containing the key 'sex' and a value of either 'M' or 'F'.</p>
            <code>{'sex': 'M'}</code>
            <p><b>Important!</b> This is not the same as the survivor's
            'effective_sex' attribute, which is mutable. Make sure you're
            modifying the correct one!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_parent/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Update a survivor's <code>father</code> or <code>mother</code>
            attributes by posting a role (e.g. 'father' or 'mother') plus a valid
            survivor OID to this endpoint:</p>
            <code>{role: 'father', 'oid': 59d78f014af5ca22ab609db2}</code>
            </td>
        </tr>



        <!-- survival -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Survival:</b>
            routes for managing the survivor's Survival value.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_survival/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> a 'modifier' integer to this route to add that number
            to the survivor's Survival: </p>
            <code>{"modifier": 2}</code>
            <p>...or:</p>
            <code>{"modifier": -1}</code>
            <p><b>Important!</b> The API will only allow values greater than the
            settlement's Survival Limit if expansion (or other) content requires
            the settlement to NOT enforce Survival Limit.</p>
            <p><b>Important!</b> The API will normalize negative numbers to zero
            automatically.</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_survival/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> a 'value' integer to this route to set that integer as
            the survivor's Survival value.: </p>
            <code>{"value": 6}</code>
            <p><b>Important!</b> The API will only allow values greater than the
            settlement's Survival Limit if expansion (or other) content requires
            the settlement to NOT enforce Survival Limit.</p>
            <p><b>Important!</b> The API will normalize negative numbers to zero
            automatically.</p> 
            </td>
        </tr>


        <!-- specialty/meta -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Specialty routes and
            'meta' data controllers:</b> these routes allow the management of
            data beyond the standard Survivor Sheet fields. These routes
            typically expect detailed/complex JSON, so read carefully!
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/controls_of_death/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>This route is the all-purpose route for managing aspects of
            a survivor's death, including when it happened, how it happened and
            so on. </p>
            <p>Supported key/value info:</p>
            <table class="embedded_table">
             <tr><th>key</th><th><b>R</b>/O</th><th>value</th></tr>
             <tr>
                <td class="key">dead</td>
                <td><b>R</b></td>
                <td class="value">Boolean. Set to 'true' if the survivor is dead.</td>
             </tr><tr>
                <td class="key">died_in</td>
                <td>O</td>
                <td class="value">Integer. The Lantern Year in which the survivor died.</td>
             </tr><tr>
                <td class="key">cause_of_death</td>
                <td>O</td>
                <td class="value">String. Can be anything, but check the settlement's
                assets for some recommended values: <code>game_assets.causes_of_death</code>
                </td>
             </tr>
            </table>
            <p>Here is some example JSON for marking a survivor dead:</p>
            <pre><code>
            {
                "dead": true,
                "died_in": 4,
                "cause_of_death": "Hack City",
            }
            </code></pre>
            <p>To resurrect a survivor (i.e. undo their death), simply post some
            JSON with  <code> {"dead": false} </code>,</p>
            <p>This will unset other death-related attributes, e.g. 'cause_of_death',
            'died_in', etc.</p>
            <p><b>Important!</b> Since <code>dead</code> is the only required key
            in JSON that gets <b>POST</b>ed to this route, there is some defaulting that goes
            on if the other values are undefined. Be as explicit as possible with
            this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_constellation/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>For survivors with Dragon Traits (i.e. PotStars), use this
            route to set their 'constellation':</p>
            <code>{'constellation': 'Witch'}</code>
            <p>Simply <b>POST</b> similar JSON to overwrite/change it:</p>
            <code>{'constellation': 'Absolute'}</code>
            <p>This one also works to unset/remove it:</p>
            <code>{'unset': true}</code>
            <p>Here is a list of accepted/supported values for 'constellation':
            <ul>
                <li>Absolute</li>
                <li>Gambler</li>
                <li>Goblin</li>
                <li>Reaper</li>
                <li>Rust</li>
                <li>Sculptor</li>
                <li>Storm</li>
                <li>Witch</li>
            </ul>
            </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_affinity/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> some JSON containing the two required keys, 'color' and
            'value' to set a single survivor affinity to a new integer value.</p>
            <code>{'color': 'blue', 'value': -2}</code>
            <p>The 'value' key must always have an integer value.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_affinities/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Works with the Survivor's <code>affinities</code> dictionary,
            which contains their permanent, non-token affinities and looks like
            this by default:</p>
            <code>{'red': 0, 'blue': 0, 'green': 0}</code>
            <p><b>POST</b> some JSON containing an optional 'operation' key whose value
            is 'add' or 'rm' to add or subtract an affinities dictionary called
            'aff_dict' to/from the survivor.</p>
            <p><b>Important!</b> The 'operation' key is optional because the default
            behavior of this method/route is to add the incoming 'aff_dict'.</p>
            <p>For example, if you wanted to add a permanent blue affinity to the
            survivor, you would <b>POST</b> this:</p>
            <code>{'aff_dict': {'blue': 1}}</code>
            <p>Similarly, if you wanted to add two red affinities and subtract
            one green affinity, you would <b>POST</b> a JSON object like this one:</p>
            <code>{'aff_dict': {'red': 2, 'green': -1}, 'operation': 'add'}</code>
            <p>If you wanted to subtract a blue and a green affinity from the
            survivor, you could <b>POST</b> a JSON object like this one:</p>
            <code>{'aff_dict': {'blue': 1, 'green': 1}, 'operation': 'rm'}</code>
            <p><b>Important!</b> The 'operation' key's value must be 'add' or
            'rm'. Anything else will get you a 400 response from this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_savior_status/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> some JSON to this route to make a survivor into
                a savior:</p>
                <code>{color: 'red'}</code>
                <p>This adds all required A&Is, logs a settlement event, etc.</p>
                <p>To change what type of savior you want the survivor to be,
                <b>POST</b> a different color:</p>
                <code>{color: 'blue'}</code>
                <p>To remove savior status (all A&Is, etc.), <b>POST</b> the
                <code>unset</code> key to this route thus:
                <code>{unset: true}</code>
            </td>
        </tr>

        <!-- toggles and flgs -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Flags and toggles:</b>
            special routes and methods for setting/unsetting 'flag' type
            aspects of the Settlement Sheet.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_damage/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> a damage location handle to this route to toggle
                it on/off for the survivor:</p>
                <code>{location: 'arms_damage_light'}</code>
                <p>Supported location handles:
                <ul>
                    <li><code>brain_damage_light</code></li>
                    <li><code>head_damage_heavy</code></li>
                    <li><code>arms_damage_light</code></li>
                    <li><code>arms_damage_heavy</code></li>
                    <li><code>body_damage_light</code></li>
                    <li><code>body_damage_heavy</code></li>
                    <li><code>waist_damage_light</code></li>
                    <li><code>waist_damage_heavy</code></li>
                    <li><code>legs_damage_light</code></li>
                    <li><code>legs_damage_heavy</code></li>
                </ul>
                </p>
                <p>Locations that are toggled 'off' will show up as <code>
                undefined</code> in the <code>sheet</code> element: the locations
                are toggled 'on' if they exist on the <code>sheet</code>.
                </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_boolean/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Use this route to toggle Boolean attributes of the survivor
            data model, such as 'public'</p>
            <code>{'attribute': 'public'}</code>
            <p><p><b>Important!</b> These attributes are not the same as <code>
            status flags</code>, which also evaluate Boolean when present on the
            survivor. See <code>set_status_flag</code> and <code>toggle_status_flag</code>
            routes below for info on working with status flags.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_fighting_arts_level/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>The API supports toggling on/off individual levels for
            Survivor Fighting Arts that have levels (e.g. Silk Surgeon). Use
            this route to toggle an individual level on or off by <b>POST</b>ing the
            handle and the level:</p>
            <code>{'handle': 'silk_surgeon', 'level': 2}</code>
            <p>The API does not enforce sequential leveling (i.e. a Survivor can
            have level 3 withing having lower levels, e.g. 1 or 2), so don't
            expect any user-friendliness here.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_sotf_reroll/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p><b>POST</b> a blank/empty request to this route to toggle the survivor's
            once per lifetime Survival of the Fittest reroll on or off.</p>
            <p><b>Important!</b> The actual attribute of the survivor's <code>
            sheet</code> is <i>sotf_reroll</i>:</p>
            <code>{"sheet": {"sotf_reroll": true, ...}, "meta": {...}, ...}</code>
            <p>But since it is not part of the default data model for survivors,
            it will sometimes simply be undefined/unset, rather than a.) always
            present and b.) always a boolean.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_status_flag/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Works nearly identically to <code>set_status_flag</code>
            (see above), except toggles the flag on/off. <b>POST</b> simple JSON
            containing the target 'flag' to toggle it:</p>
            <code>{'flag': 'cannot_use_fighting_arts'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_status_flag/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p> This route and its related route <code>toggle_status_flag</code>
            are used to work with Survivor Sheet 'flags'. The following 'flag'
            attributes can be set to a boolean value:</p>
            <ul>
                <li>cannot_spend_survival</li>
                <li>cannot_use_fighting_arts</li>
                <li>skip_next_hunt</li>
                <li>departing</li>
            </ul>
            <p>To set a flag (i.e. to True/true), <b>POST</b> some JSON to this route
            that includes the 'flag' key with the value of the flag you want to
            set:</p>
            <code>{'flag': 'cannot_spend_survival'}</code>
            <p> To unset/remove a flag, <b>POST</b> the key/value, plus the key 'unset'
            with a value of True/true:</p>
            <code>{'flag': 'skip_next_hunt', 'unset': True}</code>
            </td>
        </tr>

        <!-- misc. and meta -->
        <tr>
            <td class="subsection_header" colspan="3">
                <p><b>Meta and admin controls:</b>
                manage survivor meta data, including adding/removing survivor
                notes, avatars, color schemes, etc.</p>
                <p>(Includes any attribute of the Survivor Sheet that is NOT part
                of the in-box/paper tracking assets for the survivor.)</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_favorite/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Use this route to <b>POST</b> a user's email address and add the address
            to the survivor's <code>favorite</code> list, i.e. the list of users
            who have favorited the Survivor:</p>
            <code>{'user_email': 'demo@kdm-manager.com'}</code>
            <p> This route gracefully fails on bogus requests, so feel free to
            spam it (haha--j/k).</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_favorite/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td> <p>Use this route to <b>POST</b> a user's email address and remove the
            address from the survivor's <code>favorite</code> list, i.e. the
            list of users who have favorited the Survivor:</p>
            <code>{'user_email': 'test@kdm-manager.com'}</code>
            <p> This route gracefully fails on bogus requests and will return a
            a 200 if asked to remove a user that is not currently in the list.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_note/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Adds a text note to a survivor. The note is returned on the
                serialized survivor (in <code>survivor.notes</code>).</p>
                <p>The <b>POST</b> body requirements are simple:</p>
                <code>{'note': 'This is my important note about Ugg-Ugg the maker
                of the soup.'}</code>
                <p>Unlike other routes, this one returns the OID of the note:</p> 
                <code>{'note_oid': {$oid: '58703a398740d9730c7abeb2'}}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_note/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p><b>POST</b> an existing note OID to this route to remove it:</p>
                <code>{'_id': '58703a398740d9730c7abeb2'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> <a id="setAvatarAnchor">/survivor/set_avatar/&lt;survivor_id&gt;</a> </td>
            <td> <b>POST</b> </td>
            <td> 
                <p><b>POST</b> a base 64 encoded string to this endpoint to set a new
                avatar for a survivor:</p>
                <code>{avatar: "JJssaK1234bsakq8123..."}</code>
                <p>If you're using JS to convert a file to a base 64 string,
                consider this sample code, which may be helpful. In the sample,
                <code>evt</code> is the browser event where the users adds the file:</p>
                <pre><code>var reader = new FileReader();
reader.readAsBinaryString(evt.target.files[0]);
reader.onload = function () {
    b64_string = btoa(reader.result);
};</code></pre>
                <p>...and <code>b64_string</code> is your final output, i.e. the
                incoming file as a base 64 encoded string, that you want to <b>POST</b>
                back to the API.</p>
                <p><b>Important!</b> On a successful post, this route returns a
                200 as well as some JSON containing the OID of the new avatar:</p>
                <code>{avatar_oid: {$oid: "5a2ae8e34af5ca23a86c7247"}}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_color_scheme/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>Serialized settlements have an element called <code>survivor_color_schemes</code>,
                which is a dictionary of color schemes, including handles.</p>
                <p>To change a survivor's color scheme, <b>POST</b> some JSON to this route
                that includes one of those handles:</p>
                <code>{handle: 'vibrant_lantern'}</code>
                <p>To unset a survivor's color scheme (i.e. to remove the key/value
                from the survivor's <code>sheet</code>, simply post the key, <code>
                unset</code>:</p>
                <code>{unset: true}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_email/&lt;survivor_id&gt; </td>
            <td> <b>POST</b> </td>
            <td>
                <p>POST a registered user's email to this route to set the
                survivor's email address (which is equivalent to setting the
                survivor's "owner", but does not change the survivor's <code>
                created_by</code> attribute.</p>
                <p>Your JSON should look like this:</p>
                <code>{email: 'demo@kdm-manager.com'}</code>
                <p>In order to facilitate form validation, this route will will
                return a <code>422</code> is the <code>email</code> you POST is
                not associated with a registered user of the API.</p>
                <p><b>Important!</b> If you get a 422 back, your survivor was
                <u>not</u> updated.</p>
                <p>If the update was successful, you get a vanilla <code>200
                </code> back.</p>
            </td>
        </tr>
    </table>


 </body>
</html>
